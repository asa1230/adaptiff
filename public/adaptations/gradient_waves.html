<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="_common.css" />
  <link rel="stylesheet" href="_gradientWaves.css" />
</head>
<body>
  <svg id="preview"></svg>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
  <script src="./gradient_waves.js"></script>
  <script src="_common.js"></script>
  <script>

    let lastConfig;
    let initialized = false;
    // debug: aff_render();
    function aff_render(config) {
      // debug: config = JSON.parse();
      lastConfig = config;
      var oldPreview = document.querySelector("#preview");

      if (oldPreview) {
        window.document.body.removeChild(oldPreview);
      }

      const preview = document.createElement("canvas");
      preview.id = "preview";
      window.document.body.appendChild(preview);
      window.crazyness = config.crazyness;
      window.smoothness = config.smoothness;
      window.lines = config.lines;
      window.amplituteX = config.amplituteX;
      window.amplituteY = config.amplituteY;
      window.create();
      initialized = true;
    }


    function svgToDataURL(content) {
      var html = document.querySelector("svg").parentNode.innerHTML;
      var imgsrc = 'data:image/svg+xml;base64,' + encodeURIComponent(html);

      var image = new Image;
      image.src = imgsrc;
      return image;
    }


    function aff_download() {
      const link = document.createElement("a");


      const image = svgToDataURL();

      console.log(image);
      window.parent.postMessage({ type: "download", image });
    }
  </script>
</body>
