<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="_common.css" />
</head>
<body>
  <div id="preview"></div>
  <script>
    function aff_render(config) {
      var oldPreview = document.querySelector("#preview");
      if (oldPreview) {
        window.document.body.removeChild(oldPreview);
      }

      var pattern = window.Trianglify({
        width: window.innerWidth,
        height: window.innerHeight,
        cell_size: config.cell_size,
        variance: config.variance / 100,
        x_colors: config.palette
      });
      var canvas = pattern.canvas();
      canvas.id = "preview";

      window.document.body.appendChild(canvas);
    }
    function aff_download() {
      var link = document.createElement("a");
      var image = document
        .querySelector("#preview")
        .toDataURL("image/png")
        .replace("image/png", "image/octet-stream");
      window.parent.postMessage({ type: "download", image }, "*");
    }
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/trianglify/2.0.0/trianglify.min.js"></script>
  <script src="_common.js"></script>
</body>
